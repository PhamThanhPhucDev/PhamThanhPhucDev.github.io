<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C√¥ng c·ª• D·ª± ƒëo√°n T√†i/X·ªâu - ThanhPhucDev PRO+</title>
<style>
  @keyframes rainbowColors {
    0%   { color: #FF0000; }
    14%  { color: #FF7F00; }
    28%  { color: #FFFF00; }
    42%  { color: #00FF00; }
    57%  { color: #0000FF; }
    71%  { color: #4B0082; }
    85%  { color: #8F00FF; }
    100% { color: #FF0000; }
  }

  #rainbowName {
    text-align: center;
    font-size: 2.8em;
    font-weight: 900;
    margin: 10px 0 30px 0;
    animation: rainbowColors 10s linear infinite;
    user-select: none;
    letter-spacing: 0.15em;
    text-shadow: 0 0 10px rgba(255,255,255,0.7);
  }

  @keyframes bgColors {
    0% { background-color: #FFB6C1; }
    14% { background-color: #FFA07A; }
    28% { background-color: #FFD700; }
    42% { background-color: #90EE90; }
    57% { background-color: #87CEFA; }
    71% { background-color: #BA55D3; }
    85% { background-color: #FF69B4; }
    100% { background-color: #FFB6C1; }
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    animation: bgColors 30s infinite;
    margin: 0; padding: 20px;
    color: #222;
  }
  
  h1 {
    color: #222;
    text-align: center;
    margin-bottom: 20px;
  }
  
  .container {
    max-width: 900px;
    margin: auto;
    background: rgba(255 255 255 / 0.9);
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.15);
    padding: 25px 30px;
  }
  
  .section {
    margin-bottom: 30px;
    border: 2px solid #ddd;
    border-radius: 12px;
    padding: 20px;
    background: #fff;
    box-shadow: inset 0 0 10px #ccc;
  }
  
  label {
    font-weight: 700;
    color: #555;
  }
  
  input[type="text"], select, input[type="file"], input[type="password"] {
    font-size: 16px;
    padding: 10px 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    outline: none;
    width: 180px;
    box-sizing: border-box;
    color: #222;
  }
  
  input[type="file"] {
    width: auto;
  }
  
  button {
    background: #007acc;
    color: white;
    border: none;
    padding: 12px 25px;
    font-weight: 700;
    font-size: 16px;
    margin-top: 15px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,122,204,0.4);
    transition: background 0.3s ease;
  }
  
  button:hover {
    background: #005f99;
  }
  
  #loadStatus, #addDataStatus {
    margin-top: 10px;
    font-weight: 600;
    color: #007acc;
  }
  
  #predictionResult {
    margin-top: 15px;
    padding: 12px;
    border-radius: 10px;
    background: #e0f0ff;
    font-weight: 700;
    color: #007acc;
  }
  
  #overallStats p {
    margin: 8px 0;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  
  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }
  
  th {
    background: #007acc;
    color: white;
  }
  
  td.tai {
    color: #28a745;
    font-weight: 700;
  }
  
  td.xiu {
    color: #dc3545;
    font-weight: 700;
  }
  
  #musicControl {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #007acc;
    color: white;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 15px #007acc;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    z-index: 9999;
  }
  
  #musicControl.playing {
    background: #28a745;
    box-shadow: 0 0 15px #28a745;
  }
  
  .accuracy-meter {
    height: 20px;
    background-color: #e0e0e0;
    border-radius: 10px;
    margin: 10px 0;
    overflow: hidden;
  }
  
  .accuracy-progress {
    height: 100%;
    background-color: #4caf50;
    width: 0%;
    transition: width 0.5s;
  }
  
  .history-item {
    padding: 8px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    flex-direction: column;
  }
  
  .history-item.correct {
    background-color: #e8f5e9;
  }
  
  .history-item.incorrect {
    background-color: #ffebee;
  }
  
  .history-time {
    font-size: 0.8em;
    color: #666;
    margin-top: 5px;
  }
  
  .result-confirmation {
    background-color: #e3f2fd;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
  }
  
  .warning {
    color: #ff6b00;
    font-weight: bold;
    background-color: #fff3e0;
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    border-left: 5px solid #ff6b00;
  }
  
  .pie-charts {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    margin-top: 20px;
  }
  
  .pie-chart-container {
    width: 45%;
    height: 300px;
  }
  
  .chart-title {
    text-align: center;
    font-weight: bold;
    margin-bottom: 10px;
  }
  
  .blocker-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
    text-align: center;
    padding: 20px;
    display: none;
  }
  
  .blocker-content {
    background: #dc3545;
    padding: 30px;
    border-radius: 15px;
    max-width: 600px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  
  .blocker-title {
    font-size: 2em;
    margin-bottom: 20px;
    color: white;
  }
  
  .blocker-message {
    font-size: 1.2em;
    margin-bottom: 20px;
    line-height: 1.6;
  }
  
  .result-input-section {
    margin-top: 15px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 10px;
  }
  
  .result-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  
  .result-buttons button {
    flex: 1;
    margin-top: 0;
  }
  
  .tai-btn {
    background: #28a745;
  }
  
  .xiu-btn {
    background: #dc3545;
  }
  
  .save-notice {
    font-size: 0.9em;
    color: #666;
    margin-top: 10px;
    font-style: italic;
  }
  
  .history-controls {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  
  .history-nav {
    display: flex;
    gap: 10px;
  }
  
  .reset-btn {
    background: #dc3545;
  }
  
  .history-info {
    color: #666;
    font-size: 0.9em;
    text-align: center;
    margin-top: 10px;
  }

  .download-sample {
    margin-top: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 2px dashed #007acc;
    text-align: center;
  }
  
  .download-btn {
    display: inline-block;
    padding: 10px 20px;
    background: #2ecc71;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
    margin: 10px 0;
    transition: all 0.3s;
  }
  
  .download-btn:hover {
    background: #27ae60;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .timeout-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
    text-align: center;
    padding: 20px;
    display: none;
  }
  
  .timeout-content {
    background: #dc3545;
    padding: 30px;
    border-radius: 15px;
    max-width: 600px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  
  .timeout-title {
    font-size: 2em;
    margin-bottom: 20px;
    color: white;
  }
  
  .timeout-message {
    font-size: 1.2em;
    margin-bottom: 20px;
    line-height: 1.6;
  }
  
  .timeout-timer {
    font-size: 2.5em;
    font-weight: bold;
    margin: 20px 0;
    color: #ffcc00;
  }
  
  .timeout-icon {
    font-size: 4em;
    margin-bottom: 20px;
    animation: pulse 1.5s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* Login/Register Form Styles */
  .auth-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 10001;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
  }
  
  .auth-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    width: 400px;
    max-width: 90%;
    padding: 30px;
    animation: fadeIn 0.5s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .auth-title {
    text-align: center;
    font-size: 2em;
    margin-bottom: 30px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .auth-form input {
    padding: 12px 15px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    background: rgba(255,255,255,0.9);
    transition: all 0.3s;
  }
  
  .auth-form input:focus {
    background: white;
    box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
  }
  
  .auth-btn {
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    font-weight: bold;
    color: white;
    background: #4a00e0;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
  }
  
  .auth-btn:hover {
    background: #3700b3;
    transform: translateY(-2px);
  }
  
  .auth-switch {
    text-align: center;
    margin-top: 20px;
    color: rgba(255,255,255,0.8);
  }
  
  .auth-switch a {
    color: white;
    text-decoration: none;
    font-weight: bold;
    margin-left: 5px;
    transition: all 0.3s;
  }
  
  .auth-switch a:hover {
    text-decoration: underline;
  }
  
  .captcha-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 15px 0;
    background: rgba(255,255,255,0.2);
    padding: 10px;
    border-radius: 8px;
  }
  
  .captcha-question {
    font-weight: bold;
    color: white;
    flex: 1;
  }
  
  .captcha-input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: none;
  }
  
  .user-info {
    position: fixed;
    top: 15px;
    left: 15px;
    background: rgba(255,255,255,0.9);
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 9998;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .logout-btn {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .logout-btn:hover {
    background: #c82333;
  }
  
  .premium-badge {
    background: linear-gradient(45deg, #ffd700, #ff8c00);
    color: #333;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.8em;
    margin-left: 5px;
  }

  /* Admin Panel Styles */
  .admin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.9);
    z-index: 10002;
    display: none;
    padding: 20px;
    overflow-y: auto;
  }
  
  .admin-container {
    background: #1a1a2e;
    border-radius: 10px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
    color: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  
  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #333;
  }
  
  .admin-title {
    font-size: 24px;
    color: #f1c40f;
  }
  
  .close-admin {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
  }
  
  .user-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  
  .user-table th, .user-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #333;
  }
  
  .user-table th {
    background: #16213e;
    color: #f1c40f;
  }
  
  .user-table tr:hover {
    background: #16213e;
  }
  
  .status-active {
    color: #2ecc71;
    font-weight: bold;
  }
  
  .status-banned {
    color: #e74c3c;
    font-weight: bold;
  }
  
  .admin-btn {
    padding: 5px 10px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    margin-right: 5px;
  }
  
  .ban-btn {
    background: #e74c3c;
    color: white;
  }
  
  .unban-btn {
    background: #2ecc71;
    color: white;
  }
  
  .delete-btn {
    background: #e67e22;
    color: white;
  }
  
  .stats-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: #16213e;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
  }
  
  .stat-value {
    font-size: 28px;
    font-weight: bold;
    color: #f1c40f;
    margin: 10px 0;
  }
  
  .stat-label {
    color: #bdc3c7;
  }
  
  .admin-search {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    background: #16213e;
    border: 1px solid #333;
    color: white;
    border-radius: 5px;
  }
  
  .admin-tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid #333;
  }
  
  .admin-tab {
    padding: 10px 20px;
    cursor: pointer;
    background: #16213e;
    margin-right: 5px;
    border-radius: 5px 5px 0 0;
  }
  
  .admin-tab.active {
    background: #1a1a2e;
    border-bottom: 3px solid #f1c40f;
  }
  
  .user-details {
    display: none;
    margin-top: 20px;
    padding: 20px;
    background: #16213e;
    border-radius: 8px;
  }
  
  .user-details.active {
    display: block;
  }
</style>
</head>
<body>

<div class="auth-overlay" id="authOverlay">
  <div class="auth-container" id="loginContainer">
    <div class="auth-title">ƒêƒÇNG NH·∫¨P</div>
    <form class="auth-form" id="loginForm">
      <input type="text" id="loginUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
      <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u" required>
      
      <div class="captcha-container">
        <div class="captcha-question" id="loginCaptchaQuestion"></div>
        <input type="text" class="captcha-input" id="loginCaptchaAnswer" placeholder="K·∫øt qu·∫£?" required>
      </div>
      
      <button type="submit" class="auth-btn">ƒêƒÇNG NH·∫¨P</button>
    </form>
    <div class="auth-switch">
      Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="showRegister">ƒêƒÉng k√Ω ngay</a>
    </div>
  </div>
  
  <div class="auth-container" id="registerContainer" style="display:none;">
    <div class="auth-title">ƒêƒÇNG K√ù T√ÄI KHO·∫¢N</div>
    <form class="auth-form" id="registerForm">
      <input type="text" id="registerUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
      <input type="password" id="registerPassword" placeholder="M·∫≠t kh·∫©u" required>
      <input type="password" id="registerConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required>
      
      <div class="captcha-container">
        <div class="captcha-question" id="registerCaptchaQuestion"></div>
        <input type="text" class="captcha-input" id="registerCaptchaAnswer" placeholder="K·∫øt qu·∫£?" required>
      </div>
      
      <button type="submit" class="auth-btn">ƒêƒÇNG K√ù</button>
    </form>
    <div class="auth-switch">
      ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="showLogin">ƒêƒÉng nh·∫≠p</a>
    </div>
  </div>
</div>

<div class="user-info" id="userInfo" style="display:none;">
  <span id="usernameDisplay"></span>
  <button class="logout-btn" id="logoutBtn">‚Ü©</button>
</div>

<button id="musicControl" title="Ph√°t / T·∫°m d·ª´ng nh·∫°c">‚ñ∂</button>
<div class="blocker-overlay" id="lossBlocker">
  <div class="blocker-content">
    <div class="blocker-title">‚ö†Ô∏è C·∫¢NH B√ÅO NGHI√äM T√öC</div>
    <div class="blocker-message">
      B·∫°n ƒë√£ d·ª± ƒëo√°n sai 8 l·∫ßn li√™n ti·∫øp!<br><br>
      T√†i x·ªâu l√† tr√≤ ch∆°i may r·ªßi, kh√¥ng c√≥ c√°ch n√†o d·ª± ƒëo√°n ch√≠nh x√°c 100%.<br>
      Ti·∫øp t·ª•c ch∆°i ch·ªâ khi·∫øn b·∫°n m·∫•t nhi·ªÅu h∆°n ƒë∆∞·ª£c.<br><br>
      H√£y d·ª´ng l·∫°i ngay h√¥m nay!<br>
      T√¨m nh·ªØng tr√≤ gi·∫£i tr√≠ l√†nh m·∫°nh kh√°c t·ªët h∆°n cho cu·ªôc s·ªëng c·ªßa b·∫°n.
    </div>
    <button onclick="document.getElementById('lossBlocker').style.display='none'" style="background: white; color: #dc3545; font-weight: bold;">
      T√¥i hi·ªÉu, s·∫Ω c√¢n nh·∫Øc
    </button>
  </div>
</div>

<div class="timeout-overlay" id="timeoutBlocker">
  <div class="timeout-content">
    <div class="timeout-icon">‚è±Ô∏è</div>
    <div class="timeout-title">T·∫†M D·ª™NG HO·∫†T ƒê·ªòNG</div>
    <div class="timeout-message">
      B·∫°n ƒë√£ thua qu√° nhi·ªÅu l·∫ßn li√™n ti·∫øp!<br><br>
      H·ªá th·ªëng t·∫°m th·ªùi kh√≥a trong <span id="timeoutDuration" class="timeout-timer">3:00</span> ph√∫t<br><br>
      H√£y s·ª≠ d·ª•ng th·ªùi gian n√†y ƒë·ªÉ b√¨nh tƒ©nh l·∫°i v√† suy nghƒ© v·ªÅ chi·∫øn l∆∞·ª£c c·ªßa b·∫°n.
    </div>
    <div style="font-size:0.9em; color:#ffcc00;">
      L∆∞u √Ω: Th·ªùi gian kh√≥a s·∫Ω tƒÉng g·∫•p ƒë√¥i n·∫øu b·∫°n ti·∫øp t·ª•c thua sau khi h·∫øt h·∫°n
    </div>
  </div>
</div>

<div class="admin-overlay" id="adminOverlay">
  <div class="admin-container">
    <div class="admin-header">
      <div class="admin-title">ADMIN PANEL - QU·∫¢N L√ù H·ªÜ TH·ªêNG</div>
      <button class="close-admin" id="closeAdmin">ƒê√≥ng</button>
    </div>
    
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-label">T·ªïng s·ªë t√†i kho·∫£n</div>
        <div class="stat-value" id="totalUsers">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ƒêang ho·∫°t ƒë·ªông</div>
        <div class="stat-value" id="activeUsers">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">B·ªã kh√≥a</div>
        <div class="stat-value" id="bannedUsers">0</div>
      </div>
    </div>
    
    <input type="text" class="admin-search" id="adminSearch" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng...">
    
    <div class="admin-tabs">
      <div class="admin-tab active" data-tab="users">Danh s√°ch ng∆∞·ªùi d√πng</div>
      <div class="admin-tab" data-tab="activity">Ho·∫°t ƒë·ªông h·ªá th·ªëng</div>
    </div>
    
    <div class="tab-content" id="usersTab">
      <table class="user-table">
        <thead>
          <tr>
            <th>T√†i kho·∫£n</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Th·ªùi gian ho·∫°t ƒë·ªông</th>
            <th>L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody id="usersList">
          <!-- Danh s√°ch ng∆∞·ªùi d√πng s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
        </tbody>
      </table>
    </div>
    
    <div class="tab-content" id="activityTab" style="display:none;">
      <div id="systemActivity">
        <!-- Nh·∫≠t k√Ω ho·∫°t ƒë·ªông h·ªá th·ªëng -->
      </div>
    </div>
    
    <div class="user-details" id="userDetails">
      <h3>Chi ti·∫øt ng∆∞·ªùi d√πng: <span id="detailUsername"></span></h3>
      <div id="userDetailContent"></div>
    </div>
  </div>
</div>

<h1 id="rainbowName">THANHPHUCDEV PRO+</h1>
<div class="container" id="mainContainer" style="display:none;">
  <h1>C√¥ng c·ª• D·ª± ƒëo√°n T√†i/X·ªâu N√¢ng Cao</h1>

  <div class="section">
    <label>1. T·∫£i file d·ªØ li·ªáu (.txt):</label><br />
    <input type="file" id="fileInput" accept=".txt" />
    <div class="download-sample">
      <p style="font-weight:bold; color:#2c3e50;">T·∫¢I FILE D·ªÆ LI·ªÜU VIP</p>
      <button id="downloadVipBtn" class="download-btn">
        üì• T·∫¢I FILE M·∫™U VIP
      </button>
      <p style="font-size:12px; color:#7f8c8d; margin-top:10px;">
        File VIP ch·ª©a d·ªØ li·ªáu 500+ v√°n T√†i/X·ªâu ch·∫•t l∆∞·ª£ng cao
      </p>
    </div>
    <div id="loadStatus"></div>
  </div>

  <div class="section" id="predictionSection" style="display:none;">
    <label>2. Nh·∫≠p b·ªô x√∫c x·∫Øc v√°n tr∆∞·ªõc (3 s·ªë, c√°ch nhau d·∫•u c√°ch):</label><br />
    <input type="text" id="diceInput" placeholder="VD: 1 2 3" maxlength="5" />
    <button id="predictBtn">D·ª± ƒëo√°n</button>
    <div id="predictionResult"></div>
    
    <div class="result-input-section">
      <label>X√°c nh·∫≠n k·∫øt qu·∫£ th·ª±c t·∫ø:</label>
      <div class="result-buttons">
        <button id="confirmTaiBtn" class="tai-btn">T√†i</button>
        <button id="confirmXiuBtn" class="xiu-btn">X·ªâu</button>
      </div>
      <p class="save-notice">L∆∞u √Ω: L·ªãch s·ª≠ s·∫Ω m·∫•t khi t·∫£i l·∫°i trang. H√£y t·∫£i file l·ªãch s·ª≠ ƒë·ªÉ l∆∞u l·∫°i.</p>
    </div>
    
    <div id="accuracyTracker" style="display:none;">
      <h3>ƒê·ªô ch√≠nh x√°c d·ª± ƒëo√°n</h3>
      <div class="accuracy-meter">
        <div class="accuracy-progress" id="accuracyBar"></div>
      </div>
      <p id="accuracyText">Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√°nh gi√°</p>
    </div>
    
    <div id="patternWarning" class="warning" style="display:none;">
      <strong>C·∫¢NH B√ÅO:</strong> <span id="warningText"></span>
    </div>
  </div>

  <div class="section" id="statisticsSection" style="display:none;">
    <h2>Th·ªëng k√™ t·ªïng quan</h2>
    <div id="overallStats"></div>
    
    <div class="pie-charts">
      <div class="pie-chart-container">
        <div class="chart-title">To√†n b·ªô l·ªãch s·ª≠</div>
        <canvas id="overallPieChart"></canvas>
      </div>
      <div class="pie-chart-container">
        <div class="chart-title">20 v√°n g·∫ßn nh·∫•t</div>
        <canvas id="recentPieChart"></canvas>
      </div>
    </div>
    
    <h3>Top b·ªô s·ªë ph·ªï bi·∫øn</h3>
    <table id="topPatternsTable">
      <thead><tr><th>STT</th><th>B·ªô s·ªë</th><th>T√†i</th><th>% T√†i</th><th>X·ªâu</th><th>% X·ªâu</th><th>T·ªïng</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section" id="inputNewSection" style="display:none;">
    <h2>3. L·ªãch s·ª≠ d·ª± ƒëo√°n</h2>
    <div id="historyList" style="max-height:300px; overflow-y:auto;"></div>
    <div class="history-info" id="historyInfo"></div>
    <div class="history-controls">
      <button id="resetBtn" class="reset-btn">Reset L·ªãch s·ª≠</button>
      <div class="history-nav">
        <button id="prevBtn">‚Üê L√πi</button>
        <button id="nextBtn">Ti·∫øn ‚Üí</button>
      </div>
    </div>
    <br />
    <button id="downloadBtn">T·∫£i file .txt l·ªãch s·ª≠</button>
  </div>
</div>

<audio id="backgroundMusic" src="https://d.top4top.io/m_3411eg4pz1.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  let history = [];
  let patterns = {};
  let predictionHistory = [];
  let currentPrediction = null;
  let consecutiveLosses = 0;
  let overallPieChart = null;
  let recentPieChart = null;
  let currentPage = 1;
  const itemsPerPage = 10;
  
  // Bi·∫øn cho t√≠nh nƒÉng timeout
  let timeoutActive = false;
  let timeoutDuration = 180; // 3 ph√∫t = 180 gi√¢y
  let timeoutInterval;
  let timeoutMultiplier = 1;

  // Bi·∫øn cho h·ªá th·ªëng ƒëƒÉng nh·∫≠p
  let currentUser = null;
  let userIP = '';
  const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
  const userSessions = JSON.parse(localStorage.getItem('taiXiuSessions') || '{}');
  const userTimeouts = JSON.parse(localStorage.getItem('taiXiuTimeouts') || '{}');

  // M√£ h√≥a th√¥ng tin ƒëƒÉng nh·∫≠p admin (b·∫£o m·∫≠t c∆° b·∫£n)
  const ADMIN_CREDENTIALS = {
    username: btoa("Th4nhPhvcD3v").split('').reverse().join(''),
    password: btoa("Trucmai291029").split('').reverse().join('')
  };

  // H√†m t·∫°o CAPTCHA
  function generateCaptcha() {
    const operations = ['+', '-', '*'];
    const num1 = Math.floor(Math.random() * 10) + 1;
    const num2 = Math.floor(Math.random() * 10) + 1;
    const op = operations[Math.floor(Math.random() * operations.length)];
    
    let question = '';
    let answer = 0;
    
    switch(op) {
      case '+':
        question = `${num1} + ${num2} = ?`;
        answer = num1 + num2;
        break;
      case '-':
        question = `${num1} - ${num2} = ?`;
        answer = num1 - num2;
        break;
      case '*':
        question = `${num1} √ó ${num2} = ?`;
        answer = num1 * num2;
        break;
    }
    
    return { question, answer };
  }

  // C·∫≠p nh·∫≠t CAPTCHA cho form ƒëƒÉng nh·∫≠p
  function updateLoginCaptcha() {
    const captcha = generateCaptcha();
    document.getElementById('loginCaptchaQuestion').textContent = captcha.question;
    document.getElementById('loginCaptchaAnswer').dataset.answer = captcha.answer;
  }

  // C·∫≠p nh·∫≠t CAPTCHA cho form ƒëƒÉng k√Ω
  function updateRegisterCaptcha() {
    const captcha = generateCaptcha();
    document.getElementById('registerCaptchaQuestion').textContent = captcha.question;
    document.getElementById('registerCaptchaAnswer').dataset.answer = captcha.answer;
  }

  // L·∫•y ƒë·ªãa ch·ªâ IP (m√¥ ph·ªèng)
  function getClientIP() {
    // Trong th·ª±c t·∫ø, b·∫°n c·∫ßn server-side code ƒë·ªÉ l·∫•y IP th·ª±c
    // ƒê√¢y ch·ªâ l√† m√¥ ph·ªèng cho demo
    const fakeIPs = [
      '192.168.1.1', '10.0.0.1', '172.16.0.1', 
      '123.45.67.89', '98.76.54.32', '203.0.113.42'
    ];
    const randomIP = fakeIPs[Math.floor(Math.random() * fakeIPs.length)];
    
    // L∆∞u IP v√†o localStorage ƒë·ªÉ m√¥ ph·ªèng
    if (!localStorage.getItem('clientIP')) {
      localStorage.setItem('clientIP', randomIP);
    }
    
    return localStorage.getItem('clientIP');
  }

  // H√†m ƒëƒÉng nh·∫≠p
  function login(username, password) {
    if (!users[username]) {
      alert('T√™n ƒëƒÉng nh·∫≠p kh√¥ng t·ªìn t·∫°i!');
      return false;
    }
    
    if (users[username].password !== password) {
      alert('M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c!');
      return false;
    }
    
    // Ki·ªÉm tra CAPTCHA
    const captchaAnswer = document.getElementById('loginCaptchaAnswer').value;
    const expectedAnswer = document.getElementById('loginCaptchaAnswer').dataset.answer;
    
    if (parseInt(captchaAnswer) !== parseInt(expectedAnswer)) {
      alert('C√¢u tr·∫£ l·ªùi CAPTCHA kh√¥ng ƒë√∫ng!');
      updateLoginCaptcha();
      return false;
    }
    
    // L∆∞u session
    userIP = getClientIP();
    userSessions[userIP] = {
      username,
      loginTime: new Date().getTime(),
      timeout: userTimeouts[userIP] || 0
    };
    
    localStorage.setItem('taiXiuSessions', JSON.stringify(userSessions));
    
    currentUser = username;
    return true;
  }

  // H√†m ƒëƒÉng k√Ω
  function register(username, password) {
    if (users[username]) {
      alert('T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
      return false;
    }
    
    if (password.length < 6) {
      alert('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
      return false;
    }
    
    if (password !== document.getElementById('registerConfirmPassword').value) {
      alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
      return false;
    }
    
    // Ki·ªÉm tra CAPTCHA
    const captchaAnswer = document.getElementById('registerCaptchaAnswer').value;
    const expectedAnswer = document.getElementById('registerCaptchaAnswer').dataset.answer;
    
    if (parseInt(captchaAnswer) !== parseInt(expectedAnswer)) {
      alert('C√¢u tr·∫£ l·ªùi CAPTCHA kh√¥ng ƒë√∫ng!');
      updateRegisterCaptcha();
      return false;
    }
    
    // T·∫°o t√†i kho·∫£n m·ªõi
    users[username] = {
      password,
      createdAt: new Date().getTime(),
      isPremium: false
    };
    
    localStorage.setItem('taiXiuUsers', JSON.stringify(users));
    
    alert('ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');
    showLoginForm();
    return true;
  }

  // H√†m ƒëƒÉng xu·∫•t
  function logout() {
    if (userIP && userSessions[userIP]) {
      delete userSessions[userIP];
      localStorage.setItem('taiXiuSessions', JSON.stringify(userSessions));
    }
    
    currentUser = null;
    userIP = '';
    showAuthUI();
  }

  // Hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p
  function showLoginForm() {
    document.getElementById('loginContainer').style.display = 'block';
    document.getElementById('registerContainer').style.display = 'none';
    updateLoginCaptcha();
  }

  // Hi·ªÉn th·ªã form ƒëƒÉng k√Ω
  function showRegisterForm() {
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('registerContainer').style.display = 'block';
    updateRegisterCaptcha();
  }

  // Hi·ªÉn th·ªã UI ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω
  function showAuthUI() {
    document.getElementById('authOverlay').style.display = 'flex';
    document.getElementById('mainContainer').style.display = 'none';
    document.getElementById('userInfo').style.display = 'none';
    showLoginForm();
  }

  // Hi·ªÉn th·ªã UI ch√≠nh sau khi ƒëƒÉng nh·∫≠p
  function showMainUI() {
    document.getElementById('authOverlay').style.display = 'none';
    document.getElementById('mainContainer').style.display = 'block';
    document.getElementById('userInfo').style.display = 'flex';
    document.getElementById('usernameDisplay').textContent = currentUser;
    
    // Ki·ªÉm tra timeout
    checkTimeout();
  }

  // Ki·ªÉm tra timeout t·ª´ IP
  function checkTimeout() {
    if (userIP && userSessions[userIP] && userSessions[userIP].timeout) {
      const remaining = userSessions[userIP].timeout - Math.floor(Date.now() / 1000);
      if (remaining > 0) {
        activateTimeout(remaining);
        return true;
      }
    }
    return false;
  }

  function loadHistory() {
    if (!currentUser) return;
    
    const savedHistory = localStorage.getItem(`taiXiuHistory_${currentUser}`);
    if (savedHistory) {
      try {
        const parsed = JSON.parse(savedHistory);
        history = parsed.history || [];
        patterns = parsed.patterns || {};
        predictionHistory = parsed.predictionHistory || [];
        
        if (history.length > 0) {
          document.getElementById('predictionSection').style.display = 'block';
          document.getElementById('statisticsSection').style.display = 'block';
          document.getElementById('inputNewSection').style.display = 'block';
          document.getElementById('loadStatus').textContent = `ƒê√£ t·∫£i ${history.length} v√°n d·ªØ li·ªáu t·ª´ b·ªô nh·ªõ t·∫°m.`;
          displayStatistics();
          updateHistoryList();
          updateAccuracyDisplay();
        }
      } catch (e) {
        console.error('L·ªói khi ƒë·ªçc l·ªãch s·ª≠:', e);
      }
    }
  }

  function saveHistory() {
    if (!currentUser) return;
    
    const data = {
      history,
      patterns,
      predictionHistory
    };
    localStorage.setItem(`taiXiuHistory_${currentUser}`, JSON.stringify(data));
  }

  function resetHistory() {
    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
      history = [];
      patterns = {};
      predictionHistory = [];
      currentPage = 1;
      
      if (currentUser) {
        localStorage.removeItem(`taiXiuHistory_${currentUser}`);
      }
      
      document.getElementById('predictionSection').style.display = 'none';
      document.getElementById('statisticsSection').style.display = 'none';
      document.getElementById('inputNewSection').style.display = 'none';
      document.getElementById('loadStatus').textContent = '';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('historyInfo').textContent = '';
      
      alert('ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠!');
    }
  }

  function formatTime(date) {
    const hours = date.getHours().toString().padStart(2, '0');
    const minutes = date.getMinutes().toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${hours}:${minutes} ${day}/${month}/${year}`;
  }

  function normalizeResult(res) {
    res = res.trim().toLowerCase();
    if (res === 't' || res === 'tai') return 'Tai';
    if (res === 'x' || res === 'xiu') return 'Xiu';
    return null;
  }

  function readFile(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.onerror = e => reject(e);
      reader.readAsText(file, 'UTF-8');
    });
  }

  function processData(text) {
    history = [];
    patterns = {};
    const lines = text.split(/\r?\n/);
    for (const line of lines) {
      if (!line.trim()) continue;
      const parts = line.split('|');
      if (parts.length !== 2) continue;
      const diceStr = parts[0].trim();
      const resultRaw = parts[1].trim();
      const diceArr = diceStr.split(' ').map(x => parseInt(x)).sort((a,b) => a-b);
      if (diceArr.length !== 3 || diceArr.some(x => isNaN(x) || x < 1 || x > 6)) continue;
      const result = normalizeResult(resultRaw);
      if (!result) continue;
      history.push({dice: diceArr, result});
      const key = diceArr.join(' ');
      if (!patterns[key]) patterns[key] = {Tai: 0, Xiu: 0};
      patterns[key][result]++;
    }
    saveHistory();
  }

  function detectSuspiciousPatterns() {
    const last10 = history.slice(-10).map(h => h.result);
    const taiStreak = last10.filter(r => r === 'Tai').length;
    const xiuStreak = last10.filter(r => r === 'Xiu').length;
    
    if (taiStreak >= 8 || xiuStreak >= 8) {
      return {
        warning: true,
        message: `C·∫£nh b√°o: ${taiStreak >= 8 ? 'T√†i' : 'X·ªâu'} li√™n t·ª•c ${Math.max(taiStreak, xiuStreak)} l·∫ßn. C√≥ th·ªÉ b·ªãp!`
      };
    }
    
    if (last10.length >= 5) {
      const pattern = last10.join('');
      if (/(Tai){5}|(Xiu){5}/.test(pattern)) {
        return {
          warning: true,
          message: "C·∫£nh b√°o: Xu·∫•t hi·ªán chu·ªói 5 k·∫øt qu·∫£ gi·ªëng nhau li√™n ti·∫øp!"
        };
      }
    }
    
    return { warning: false };
  }

  function predict(dice) {
    const key = dice.slice().sort((a,b) => a-b).join(' ');
    const stats = patterns[key] || {Tai: 0, Xiu: 0};
    const total = stats.Tai + stats.Xiu;
    
    const lastResults = history.slice(-5).map(h => h.result);
    const sequencePattern = lastResults.join('');
    let sequenceAnalysis = {Tai: 0, Xiu: 0};
    
    if (lastResults.length >= 3) {
      sequenceAnalysis = {
        Tai: sequencePattern.split('Tai').length - 1,
        Xiu: sequencePattern.split('Xiu').length - 1
      };
    }
    
    if (total === 0) {
      const sumDice = dice.reduce((a,b) => a+b, 0);
      const similar = history.filter(h => h.dice.reduce((a,b) => a+b, 0) === sumDice);
      if (similar.length === 0) {
        return {
          prediction: 'Kh√¥ng ƒë·ªß d·ªØ li·ªáu',
          taiPercent: 0,
          xiuPercent: 0,
          totalMatches: 0,
          method: 'Kh√¥ng c√≥ d·ªØ li·ªáu'
        };
      }
      const taiCount = similar.filter(h => h.result === 'Tai').length;
      const xiuCount = similar.length - taiCount;
      const taiPercent = taiCount / similar.length * 100;
      const xiuPercent = xiuCount / similar.length * 100;
      return {
        prediction: taiPercent > xiuPercent ? 'Tai' : 'Xiu',
        confidence: Math.max(taiPercent, xiuPercent),
        taiPercent,
        xiuPercent,
        totalMatches: similar.length,
        method: `D·ª±a tr√™n ${similar.length} v√°n c√≥ t·ªïng ƒëi·ªÉm ${sumDice}`
      };
    } else {
      const combinedTai = stats.Tai * 0.7 + sequenceAnalysis.Tai * 0.3;
      const combinedXiu = stats.Xiu * 0.7 + sequenceAnalysis.Xiu * 0.3;
      const combinedTotal = combinedTai + combinedXiu;
      
      const taiPercent = combinedTai / combinedTotal * 100;
      const xiuPercent = combinedXiu / combinedTotal * 100;
      
      return {
        prediction: taiPercent > xiuPercent ? 'Tai' : 'Xiu',
        confidence: Math.max(taiPercent, xiuPercent),
        taiPercent,
        xiuPercent,
        totalMatches: total,
        method: `D·ª±a tr√™n ${total} v√°n c√≥ b·ªô s·ªë ${key} v√† ph√¢n t√≠ch chu·ªói`
      };
    }
  }

  function displayPrediction(pred) {
    currentPrediction = pred;
    const container = document.getElementById('predictionResult');
    container.innerHTML = '';
    if (pred.totalMatches === 0) {
      container.innerHTML = `<p style="color:#ff6666;">${pred.prediction}</p>`;
      return;
    }
    
    const taiBar = '‚ñà'.repeat(Math.round(pred.taiPercent / 5));
    const xiuBar = '‚ñà'.repeat(Math.round(pred.xiuPercent / 5));
    container.innerHTML = `
      <p><b>Ph∆∞∆°ng ph√°p:</b> ${pred.method}</p>
      <p>T·ª∑ l·ªá d·ª±a tr√™n <b>${pred.totalMatches}</b> l·∫ßn xu·∫•t hi·ªán:</p>
      <p style="color:#28a745;">T√†i: ${taiBar} ${pred.taiPercent.toFixed(1)}%</p>
      <p style="color:#dc3545;">X·ªâu: ${xiuBar} ${pred.xiuPercent.toFixed(1)}%</p>
      <p><b>D·ª± ƒëo√°n:</b> ${pred.prediction} (<i>${pred.confidence.toFixed(1)}% tin c·∫≠y</i>)</p>
    `;
    
    document.getElementById('accuracyTracker').style.display = 'block';
    updateAccuracyDisplay();
    
    const patternCheck = detectSuspiciousPatterns();
    const warningDiv = document.getElementById('patternWarning');
    if (patternCheck.warning) {
      warningDiv.style.display = 'block';
      document.getElementById('warningText').textContent = patternCheck.message;
    } else {
      warningDiv.style.display = 'none';
    }
  }

  function updateAccuracyDisplay() {
    const correct = predictionHistory.filter(p => p.correct).length;
    const total = predictionHistory.length;
    const accuracy = total > 0 ? (correct / total * 100) : 0;
    
    document.getElementById('accuracyBar').style.width = `${accuracy}%`;
    document.getElementById('accuracyText').textContent = total > 0 ?
      `ƒê·ªô ch√≠nh x√°c: ${accuracy.toFixed(1)}% (${correct}/${total})` :
      'Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√°nh gi√°';
  }

  function updateHistoryList() {
    const historyList = document.getElementById('historyList');
    const historyInfo = document.getElementById('historyInfo');
    historyList.innerHTML = '';
    
    const totalPages = Math.ceil(predictionHistory.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = Math.min(startIndex + itemsPerPage, predictionHistory.length);
    const currentItems = predictionHistory.slice().reverse().slice(startIndex, endIndex);
    
    currentItems.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = `history-item ${item.correct ? 'correct' : 'incorrect'}`;
      div.innerHTML = `
        <div>
          <span>${predictionHistory.length - startIndex - index}. ${item.dice} ‚Üí D·ª± ƒëo√°n: ${item.prediction}</span>
          <span>K·∫øt qu·∫£: ${item.actualResult} (${item.correct ? 'ƒê√öNG' : 'SAI'})</span>
        </div>
        <div class="history-time">${formatTime(new Date(item.timestamp))}</div>
      `;
      historyList.appendChild(div);
    });
    
    historyInfo.textContent = `Trang ${currentPage}/${totalPages} - Hi·ªÉn th·ªã ${startIndex + 1}-${endIndex} c·ªßa ${predictionHistory.length} m·ª•c`;
    
    // Disable/enable navigation buttons
    document.getElementById('prevBtn').disabled = currentPage <= 1;
    document.getElementById('nextBtn').disabled = currentPage >= totalPages;
  }

  function updatePieCharts() {
    // Overall pie chart
    const overallCtx = document.getElementById('overallPieChart').getContext('2d');
    const taiCount = history.filter(h => h.result === 'Tai').length;
    const xiuCount = history.length - taiCount;
    
    if (overallPieChart) {
      overallPieChart.data.datasets[0].data = [taiCount, xiuCount];
      overallPieChart.update();
    } else {
      overallPieChart = new Chart(overallCtx, {
        type: 'pie',
        data: {
          labels: ['T√†i', 'X·ªâu'],
          datasets: [{
            data: [taiCount, xiuCount],
            backgroundColor: ['#28a745', '#dc3545'],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
    
    // Recent pie chart (last 20 games)
    const recentCtx = document.getElementById('recentPieChart').getContext('2d');
    const last20 = history.slice(-20);
    const recentTai = last20.filter(h => h.result === 'Tai').length;
    const recentXiu = last20.length - recentTai;
    
    if (recentPieChart) {
      recentPieChart.data.datasets[0].data = [recentTai, recentXiu];
      recentPieChart.update();
    } else {
      recentPieChart = new Chart(recentCtx, {
        type: 'pie',
        data: {
          labels: ['T√†i', 'X·ªâu'],
          datasets: [{
            data: [recentTai, recentXiu],
            backgroundColor: ['#28a745', '#dc3545'],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
  }

  function displayStatistics() {
    const overallDiv = document.getElementById('overallStats');
    const totalGames = history.length;
    if (totalGames === 0) {
      overallDiv.innerHTML = '<p style="color:#dc3545;">Ch∆∞a c√≥ d·ªØ li·ªáu th·ªëng k√™!</p>';
      return;
    }
    const taiCount = history.filter(h => h.result === 'Tai').length;
    const xiuCount = totalGames - taiCount;
    overallDiv.innerHTML = `
      <p><b>T·ªïng s·ªë v√°n ƒë√£ ghi nh·∫≠n:</b> ${totalGames}</p>
      <p style="color:#28a745;"><b>S·ªë l·∫ßn T√†i:</b> ${taiCount} (${(taiCount / totalGames * 100).toFixed(1)}%)</p>
      <p style="color:#dc3545;"><b>S·ªë l·∫ßn X·ªâu:</b> ${xiuCount} (${(xiuCount / totalGames * 100).toFixed(1)}%)</p>
    `;
    
    updatePieCharts();
    
    const topPatterns = Object.entries(patterns)
      .map(([dice, stats]) => {
        const total = stats.Tai + stats.Xiu;
        return {
          dice,
          Tai: stats.Tai,
          Xiu: stats.Xiu,
          total,
          taiPercent: total ? (stats.Tai / total * 100) : 0,
          xiuPercent: total ? (stats.Xiu / total * 100) : 0
        };
      })
      .sort((a, b) => b.total - a.total)
      .slice(0, 10);
    
    const tbody = document.querySelector('#topPatternsTable tbody');
    tbody.innerHTML = '';
    topPatterns.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${p.dice}</td>
        <td class="tai">${p.Tai}</td>
        <td class="tai">${p.taiPercent.toFixed(1)}%</td>
        <td class="xiu">${p.Xiu}</td>
        <td class="xiu">${p.xiuPercent.toFixed(1)}%</td>
        <td>${p.total}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function activateTimeout(seconds = null) {
    const timeoutSeconds = seconds || (timeoutDuration * timeoutMultiplier);
    timeoutActive = true;
    
    // L∆∞u timeout v√†o IP
    if (userIP) {
      userSessions[userIP].timeout = Math.floor(Date.now() / 1000) + timeoutSeconds;
      userTimeouts[userIP] = userSessions[userIP].timeout;
      localStorage.setItem('taiXiuSessions', JSON.stringify(userSessions));
      localStorage.setItem('taiXiuTimeouts', JSON.stringify(userTimeouts));
    }
    
    document.getElementById('timeoutBlocker').style.display = 'flex';
    
    // V√¥ hi·ªáu h√≥a c√°c n√∫t ch·ª©c nƒÉng
    document.getElementById('predictBtn').disabled = true;
    document.getElementById('confirmTaiBtn').disabled = true;
    document.getElementById('confirmXiuBtn').disabled = true;
    
    // C·∫≠p nh·∫≠t th·ªùi gian kh√≥a ban ƒë·∫ßu
    updateTimeoutDisplay(timeoutSeconds);
    
    // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c
    let remaining = timeoutSeconds;
    timeoutInterval = setInterval(() => {
      remaining--;
      updateTimeoutDisplay(remaining);
      
      if (remaining <= 0) {
        clearTimeout(timeoutInterval);
        timeoutActive = false;
        document.getElementById('timeoutBlocker').style.display = 'none';
        document.getElementById('predictBtn').disabled = false;
        document.getElementById('confirmTaiBtn').disabled = false;
        document.getElementById('confirmXiuBtn').disabled = false;
        
        // X√≥a timeout kh·ªèi IP
        if (userIP && userSessions[userIP]) {
          userSessions[userIP].timeout = 0;
          localStorage.setItem('taiXiuSessions', JSON.stringify(userSessions));
        }
      }
    }, 1000);
  }
  
  function updateTimeoutDisplay(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    document.getElementById('timeoutDuration').textContent = 
      `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  }
  
  function checkConsecutiveLosses() {
    const last8 = predictionHistory.slice(-8);
    if (last8.length < 8) return;
    
    const allLosses = last8.every(p => !p.correct);
    if (allLosses) {
      document.getElementById('lossBlocker').style.display = 'flex';
      timeoutMultiplier *= 2; // TƒÉng g·∫•p ƒë√¥i th·ªùi gian cho l·∫ßn sau
      activateTimeout();
    }
  }

  // Ki·ªÉm tra ƒëƒÉng nh·∫≠p admin
  function checkAdminLogin(username, password) {
    const encryptedUsername = btoa(username).split('').reverse().join('');
    const encryptedPassword = btoa(password).split('').reverse().join('');
    
    return encryptedUsername === ADMIN_CREDENTIALS.username && 
           encryptedPassword === ADMIN_CREDENTIALS.password;
  }

  // Hi·ªÉn th·ªã admin panel
  function showAdminPanel() {
    document.getElementById('adminOverlay').style.display = 'block';
    loadAdminData();
  }

  // T·∫£i d·ªØ li·ªáu qu·∫£n tr·ªã
  function loadAdminData() {
    const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
    const sessions = JSON.parse(localStorage.getItem('taiXiuSessions') || '{}');
    const timeouts = JSON.parse(localStorage.getItem('taiXiuTimeouts') || '{}');
    
    // Th·ªëng k√™
    const userList = Object.keys(users);
    document.getElementById('totalUsers').textContent = userList.length;
    document.getElementById('activeUsers').textContent = userList.filter(u => !users[u].isBanned).length;
    document.getElementById('bannedUsers').textContent = userList.filter(u => users[u].isBanned).length;
    
    // Hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng
    const usersList = document.getElementById('usersList');
    usersList.innerHTML = '';
    
    userList.forEach(username => {
      const user = users[username];
      const session = sessions[getUserIP(username)] || {};
      const timeout = timeouts[getUserIP(username)] || 0;
      
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${username}</td>
        <td class="${user.isBanned ? 'status-banned' : 'status-active'}">
          ${user.isBanned ? 'ƒê√£ kh√≥a' : 'ƒêang ho·∫°t ƒë·ªông'}
        </td>
        <td>${formatTimePeriod(user.createdAt)}</td>
        <td>${session.loginTime ? new Date(session.loginTime).toLocaleString() : 'Ch∆∞a ƒëƒÉng nh·∫≠p'}</td>
        <td>
          ${user.isBanned ? 
            `<button class="admin-btn unban-btn" data-user="${username}">M·ªü kh√≥a</button>` : 
            `<button class="admin-btn ban-btn" data-user="${username}">Kh√≥a</button>`}
          <button class="admin-btn delete-btn" data-user="${username}">X√≥a</button>
          <button class="admin-btn detail-btn" data-user="${username}">Chi ti·∫øt</button>
        </td>
      `;
      usersList.appendChild(tr);
    });
    
    // Th√™m s·ª± ki·ªán cho c√°c n√∫t
    document.querySelectorAll('.ban-btn').forEach(btn => {
      btn.addEventListener('click', () => banUser(btn.dataset.user));
    });
    
    document.querySelectorAll('.unban-btn').forEach(btn => {
      btn.addEventListener('click', () => unbanUser(btn.dataset.user));
    });
    
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', () => deleteUser(btn.dataset.user));
    });
    
    document.querySelectorAll('.detail-btn').forEach(btn => {
      btn.addEventListener('click', () => showUserDetails(btn.dataset.user));
    });
  }

  // ƒê·ªãnh d·∫°ng th·ªùi gian ho·∫°t ƒë·ªông
  function formatTimePeriod(timestamp) {
    const now = Date.now();
    const diff = now - timestamp;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    
    return `${days} ng√†y ${hours} gi·ªù`;
  }

  // L·∫•y IP c·ªßa ng∆∞·ªùi d√πng (gi·∫£ l·∫≠p)
  function getUserIP(username) {
    const sessions = JSON.parse(localStorage.getItem('taiXiuSessions') || '{}');
    for (const ip in sessions) {
      if (sessions[ip].username === username) {
        return ip;
      }
    }
    return null;
  }

  // Kh√≥a ng∆∞·ªùi d√πng
  function banUser(username) {
    if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√≥a t√†i kho·∫£n ${username}?`)) {
      const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
      if (users[username]) {
        users[username].isBanned = true;
        localStorage.setItem('taiXiuUsers', JSON.stringify(users));
        loadAdminData();
        alert(`ƒê√£ kh√≥a t√†i kho·∫£n ${username}`);
      }
    }
  }

  // M·ªü kh√≥a ng∆∞·ªùi d√πng
  function unbanUser(username) {
    const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
    if (users[username]) {
      users[username].isBanned = false;
      localStorage.setItem('taiXiuUsers', JSON.stringify(users));
      
      // X√≥a timeout n·∫øu c√≥
      const ip = getUserIP(username);
      if (ip) {
        const timeouts = JSON.parse(localStorage.getItem('taiXiuTimeouts') || '{}');
        delete timeouts[ip];
        localStorage.setItem('taiXiuTimeouts', JSON.stringify(timeouts));
      }
      
      loadAdminData();
      alert(`ƒê√£ m·ªü kh√≥a t√†i kho·∫£n ${username}`);
    }
  }

  // X√≥a ng∆∞·ªùi d√πng
  function deleteUser(username) {
    if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA Vƒ®NH VI·ªÑN t√†i kho·∫£n ${username}?`)) {
      const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
      delete users[username];
      localStorage.setItem('taiXiuUsers', JSON.stringify(users));
      
      // X√≥a l·ªãch s·ª≠ ng∆∞·ªùi d√πng
      localStorage.removeItem(`taiXiuHistory_${username}`);
      
      loadAdminData();
      alert(`ƒê√£ x√≥a t√†i kho·∫£n ${username}`);
    }
  }

  // Hi·ªÉn th·ªã chi ti·∫øt ng∆∞·ªùi d√πng
  function showUserDetails(username) {
    const users = JSON.parse(localStorage.getItem('taiXiuUsers') || '{}');
    const user = users[username];
    const ip = getUserIP(username);
    const sessions = JSON.parse(localStorage.getItem('taiXiuSessions') || '{}');
    const session = sessions[ip] || {};
    const history = JSON.parse(localStorage.getItem(`taiXiuHistory_${username}`) || '{"history": []}');
    
    document.getElementById('detailUsername').textContent = username;
    document.getElementById('userDetailContent').innerHTML = `
      <p><strong>Ng√†y t·∫°o:</strong> ${new Date(user.createdAt).toLocaleString()}</p>
      <p><strong>Tr·∫°ng th√°i:</strong> ${user.isBanned ? '<span style="color:#e74c3c">ƒê√£ kh√≥a</span>' : '<span style="color:#2ecc71">ƒêang ho·∫°t ƒë·ªông</span>'}</p>
      <p><strong>IP hi·ªán t·∫°i:</strong> ${ip || 'Kh√¥ng c√≥ th√¥ng tin'}</p>
      <p><strong>L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi:</strong> ${session.loginTime ? new Date(session.loginTime).toLocaleString() : 'Ch∆∞a ƒëƒÉng nh·∫≠p'}</p>
      <p><strong>Th·ªùi gian kh√≥a c√≤n l·∫°i:</strong> ${session.timeout ? Math.max(0, Math.floor((session.timeout - Date.now()/1000)/60)) + ' ph√∫t' : 'Kh√¥ng b·ªã kh√≥a'}</p>
      <p><strong>S·ªë l·∫ßn d·ª± ƒëo√°n:</strong> ${history.predictionHistory ? history.predictionHistory.length : 0}</p>
      <p><strong>T·ª∑ l·ªá d·ª± ƒëo√°n ƒë√∫ng:</strong> ${calculateAccuracy(history)}</p>
    `;
    
    document.getElementById('userDetails').classList.add('active');
  }

  // T√≠nh t·ª∑ l·ªá d·ª± ƒëo√°n ƒë√∫ng
  function calculateAccuracy(history) {
    if (!history.predictionHistory || history.predictionHistory.length === 0) {
      return 'Ch∆∞a c√≥ d·ªØ li·ªáu';
    }
    
    const correct = history.predictionHistory.filter(p => p.correct).length;
    const total = history.predictionHistory.length;
    const accuracy = (correct / total * 100).toFixed(1);
    
    return `${accuracy}% (${correct}/${total})`;
  }

  // X·ª≠ l√Ω t·∫£i file d·ªØ li·ªáu l√™n
  document.getElementById('fileInput').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById('loadStatus').textContent = 'ƒêang t·∫£i v√† x·ª≠ l√Ω d·ªØ li·ªáu...';
    try {
      const text = await readFile(file);
      processData(text);
      document.getElementById('loadStatus').textContent = `ƒê√£ t·∫£i ${history.length} v√°n d·ªØ li·ªáu.`;
      document.getElementById('predictionSection').style.display = 'block';
      document.getElementById('statisticsSection').style.display = 'block';
      document.getElementById('inputNewSection').style.display = 'block';
      displayStatistics();
      document.getElementById('predictionResult').innerHTML = '';
      updateHistoryList();
    } catch (err) {
      document.getElementById('loadStatus').textContent = 'L·ªói khi ƒë·ªçc file.';
      console.error(err);
    }
  });

  // N√∫t d·ª± ƒëo√°n
  document.getElementById('predictBtn').addEventListener('click', () => {
    if (timeoutActive) {
      alert('H·ªá th·ªëng ƒëang t·∫°m kh√≥a do b·∫°n thua qu√° nhi·ªÅu l·∫ßn. Vui l√≤ng ƒë·ª£i...');
      return;
    }
    
    const input = document.getElementById('diceInput').value.trim();
    const parts = input.split(' ').map(x => parseInt(x));
    if (parts.length !== 3 || parts.some(x => isNaN(x) || x < 1 || x > 6)) {
      alert('Vui l√≤ng nh·∫≠p ƒë√∫ng 3 s·ªë x√∫c x·∫Øc (1 ƒë·∫øn 6), c√°ch nhau d·∫•u c√°ch.');
      return;
    }
    const pred = predict(parts);
    displayPrediction(pred);
  });

  // X√°c nh·∫≠n k·∫øt qu·∫£ th·ª±c t·∫ø
  document.getElementById('confirmTaiBtn').addEventListener('click', () => confirmResult('Tai'));
  document.getElementById('confirmXiuBtn').addEventListener('click', () => confirmResult('Xiu'));

  function confirmResult(actualResult) {
    if (timeoutActive) {
      alert('H·ªá th·ªëng ƒëang t·∫°m kh√≥a do b·∫°n thua qu√° nhi·ªÅu l·∫ßn. Vui l√≤ng ƒë·ª£i...');
      return;
    }
    
    const diceInput = document.getElementById('diceInput').value.trim();
    const diceParts = diceInput.split(' ').map(x => parseInt(x));
    const sortedDice = diceParts.slice().sort((a,b) => a-b);
    const key = sortedDice.join(' ');
    
    if (currentPrediction && currentPrediction.prediction !== 'Kh√¥ng ƒë·ªß d·ªØ li·ªáu') {
      const isCorrect = currentPrediction.prediction === actualResult;
      
      if (isCorrect) {
        consecutiveLosses = 0;
      } else {
        consecutiveLosses++;
      }
      
      predictionHistory.push({
        dice: key,
        prediction: currentPrediction.prediction,
        actualResult,
        correct: isCorrect,
        confidence: currentPrediction.confidence,
        timestamp: new Date()
      });
      
      history.push({dice: sortedDice, result: actualResult});
      if (!patterns[key]) patterns[key] = {Tai: 0, Xiu: 0};
      patterns[key][actualResult]++;
      
      updateAccuracyDisplay();
      updateHistoryList();
      displayStatistics();
      saveHistory();
      
      checkConsecutiveLosses();
    }
    
    document.getElementById('diceInput').value = '';
  }

  // T·∫£i file l·ªãch s·ª≠
  document.getElementById('downloadBtn').addEventListener('click', () => {
    if (history.length === 0) {
      alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i xu·ªëng.');
      return;
    }
    let content = '';
    for (const entry of history) {
      content += `${entry.dice.join(' ')}|${entry.result}\n`;
    }
    const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'cautaixiu_updated.txt';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
  });

  // T·∫£i file VIP
  document.getElementById('downloadVipBtn').addEventListener('click', function() {
    const vipData = `1 2 2|Tai
1 3 4|Xiu
1 1 3|Tai
2 4 5|Xiu
2 2 6|Tai
5 6 6|Xiu
1 4 5|Xiu
2 2 5|Tai
2 3 6|Xiu
3 5 6|Xiu
1 2 3|Xiu
2 2 5|Tai
2 5 6|Xiu
1 2 3|Xiu
2 3 3|Tai
1 5 6|Xiu
1 2 3|Xiu
2 2 6|Xiu
2 3 5|Xiu
1 1 3|Tai
1 6 6|Xiu
1 3 3|Tai
4 4 6|Tai
1 5 5|Tai
2 4 5|Xiu
1 3 3|Xiu
2 3 4|Tai
2 4 6|Tai
1 3 6|Xiu
1 3 6|Xiu
1 2 3|Xiu
2 2 5|Xiu
1 1 4|Tai
6 6 6|Xiu
2 2 3|Tai
1 3 6|Xiu
2 3 5|Xiu
3 4 5|Xiu
2 3 4|Xiu
1 2 3|Xiu
2 2 5|Xiu
2 2 5|Xiu
1 6 6|Xiu
4 6 6|Tai
3 4 4|Tai
3 3 5|Xiu
1 2 4|Xiu
1 3 4|Xiu
3 3 6|Tai
3 4 6|Xiu
1 1 2|Xiu
2 3 5|Xiu
1 3 6|Xiu
1 2 4|Xiu
1 3 3|Xiu
2 3 4|Xiu
3 4 5|Xiu
4 4 4|Tai
3 3 6|Tai
2 5 6|Xiu
1 4 5|Tai
4 6 6|Tai
1 4 6|Tai
3 4 5|Xiu
2 3 4|Xiu
1 3 3|Xiu
1 3 5|Xiu
2 2 6|Xiu
5 5 6|Xiu
1 2 4|Xiu
1 3 6|Xiu
3 4 5|Xiu
1 3 5|Tai
1 2 2|Xiu
1 2 3|Xiu
1 2 4|Xiu
3 3 4|Tai
3 4 6|Tai
4 5 6|Tai
5 5 6|Xiu
4 4 6|Tai
3 5 6|Tai
2 3 6|Tai
4 5 6|Tai
4 5 6|Xiu
2 2 3|Xiu
2 3 4|Xiu
1 1 6|Xiu
1 2 4|Xiu
1 2 3|Xiu
1 2 4|Xiu
2 2 5|Xiu
2 3 5|Tai
3 4 5|Tai
3 4 6|Tai
4 4 5|Tai
3 3 6|Tai
3 3 5|Xiu
2 2 6|Tai
4 5 6|Tai
1 5 5|Tai
3 4 6|Tai
3 5 6|Tai
4 4 5|Xiu
1 1 3|Tai
2 5 6|Xiu
1 1 5|Xiu
2 3 5|Xiu
1 3 6|Tai
4 4 6|Tai
4 5 6|Tai
4 5 6|Xiu
2 3 5|Tai
2 6 6|Tai
1 5 5|Tai
2 4 6|Tai
3 4 4|Tai
4 5 6|Tai
3 5 6|Tai
1 5 5|Tai
3 4 6|Xiu
1 3 5|Xiu
2 4 4|Xiu
3 4 4|Tai
1 5 6|Tai
1 4 6|Tai
5 5 5|Xiu
1 2 5|Xiu
1 2 5|Xiu
4 5 6|Tai
3 5 6|Xiu
1 4 5|Xiu
1 1 6|Tai
2 4 5|Tai
1 2 3|Xiu
1 2 5|Tai
5 5 6|Xiu
1 3 4|Xiu
1 3 3|Tai
3 6 6|Tai
5 5 6|Xiu
5 5 5|Xiu
2 3 3|Xiu
1 2 4|Tai
1 2 5|Xiu
2 2 3|Xiu
1 2 6|Tai
3 3 6|Tai
1 5 6|Tai
4 5 6|Tai
4 5 6|Xiu
1 1 5|Tai
4 4 5|Xiu
2 3 4|Xiu
1 3 4|Xiu
2 2 3|Tai
4 5 6|Xiu
1 1 5|Xiu
2 3 4|Tai
4 6 6|Tai
2 4 5|Tai
1 1 2|Xiu
1 1 5|Xiu
3 3 5|Tai
1 5 6|Xiu
2 3 4|Xiu
1 2 6|Tai
4 5 5|Xiu
1 2 5|Tai
4 6 6|Tai
5 5 6|Xiu
1 2 4|Tai
4 6 6|Xiu
1 2 6|Xiu
1 2 6|Xiu
3 6 6|Tai
3 4 6|Xiu
1 1 3|Tai
4 4 5|Tai
4 5 6|Tai
3 5 6|Tai
3 6 6|Tai
2 5 5|Xiu
1 5 5|Xiu
1 2 6|Tai
2 5 5|Tai
3 4 6|Xiu
4 4 6|Xiu
1 1 4|Tai
1 5 6|Tai
1 5 6|Xiu
2 3 3|Tai
3 4 5|Xiu
1 2 5|Xiu
1 2 4|Tai
3 4 4|Xiu
1 4 4|Xiu
2 6 6|Xiu
1 2 4|Xiu
1 3 5|Tai
2 4 6|Tai
4 4 4|Tai
1 4 6|Xiu
1 2 6|Xiu
3 4 4|Xiu
2 2 6|Tai
1 3 3|Tai
3 4 5|Tai
3 5 6|Xiu
1 1 3|Tai
1 4 6|Xiu
1 4 4|Xiu
1 2 4|Xiu
1 2 3|Tai
3 3 5|Tai
3 3 3|Xiu
2 3 5|Xiu
1 4 5|Tai
3 5 6|Xiu
1 2 2|Xiu
2 2 4|Tai
2 4 6|Xiu
2 2 4|Xiu
1 2 3|Xiu
2 3 4|Tai
3 4 6|Xiu
1 1 6|Tai
4 4 6|Xiu
2 4 4|Xiu
1 1 5|Tai
3 6 6|Xiu
1 2 4|Tai
3 4 5|Tai
3 4 4|Tai
1 5 5|Xiu
2 2 2|Tai
4 5 6|Xiu
1 3 4|Xiu
2 2 2|Xiu
1 2 5|Xiu
1 1 3|Xiu
3 4 6|Tai
2 3 6|Xiu
1 3 3|Xiu
3 6 6|Tai
4 5 5|Xiu
2 3 4|Tai
4 5 6|Tai
1 5 6|Xiu
1 1 6|Tai
3 4 5|Xiu
1 5 6|Tai
3 3 6|Tai
1 5 6|Xiu
1 3 6|Xiu
3 6 6|Tai
2 3 6|Tai
2 4 6|Xiu
1 2 3|Tai
2 5 6|Xiu
1 1 2|Tai
4 4 6|Tai
4 5 6|Tai
1 6 6|Xiu
2 2 5|Tai
5 5 6|Tai
4 5 5|Xiu
2 2 5|Tai
4 4 4|Xiu
2 3 4|Tai
1 4 6|Xiu
1 3 6|Tai
3 5 6|Tai
3 4 6|Xiu
2 4 4|Tai
3 4 5|Xiu
1 4 5|Tai
1 4 6|Tai
3 4 6|Tai
2 5 5|Tai
3 3 5|Tai
1 2 6|Xiu
5 6 6|Xiu
3 3 4|Tai
3 4 6|Tai
4 4 6|Tai
3 4 4|Tai
1 5 5|Xiu
1 2 4|Tai
4 4 5|Xiu
1 2 2|Xiu
1 2 5|Xiu
1 1 4|Xiu
1 3 6|Xiu
2 3 5|Xiu
1 4 4|Xiu
1 3 5|Tai
2 3 6|Xiu
1 2 4|Tai
2 4 6|Tai
2 4 6|Tai
1 5 6|Tai
1 5 5|Tai
1 4 6|Xiu
1 4 4|Tai
2 4 6|Tai
2 3 6|Tai
2 4 6|Xiu
3 3 4|Xiu
1 2 6|Xiu
1 2 3|Tai
1 4 6|Tai
3 5 6|Xiu
3 6 6|Tai
4 5 6|Xiu
2 4 4|Tai
4 5 6|Xiu
1 2 2|Tai
4 4 5|Xiu
2 2 5|Tai
3 3 4|Tai
1 4 6|Xiu
1 2 4|Tai
4 5 5|Xiu
2 3 5|Tai
1 4 6|Xiu
2 3 5|Xiu
2 2 6|Xiu
1 3 3|Xiu
1 1 3|Xiu
2 2 4|Tai
1 5 5|Xiu
1 3 6|Xiu
1 3 5|Tai
3 5 5|Xiu
1 1 2|Tai
1 4 6|Xiu
1 3 3|Xiu
1 2 5|Xiu
2 2 5|Tai
2 4 6|Tai
3 5 5|Tai
3 4 5|Tai
4 6 6|Xiu
1 3 6|Tai
2 3 6|Tai
1 4 5|Xiu
2 3 3|Tai
4 5 6|Tai
5 5 6|Xiu
1 2 4|Xiu
1 4 5|Xiu
1 3 5|Tai
4 5 5|Tai
3 4 4|Xiu
1 1 3|Xiu
2 2 6|Xiu
2 2 3|Tai
2 4 6|Xiu
3 3 3|Xiu
1 1 3|Xiu
2 4 4|Xiu
1 4 5|Xiu
2 2 5|Tai
2 3 6|Xiu
1 3 5|Xiu
2 5 5|Tai
2 5 6|Xiu
1 1 3|Tai
2 4 5|Xiu
1 2 4|Tai
3 3 6|Tai
3 4 5|Xiu
2 2 4|Tai
2 5 5|Xiu
1 1 5|Tai
1 4 6|Tai
3 5 5|Xiu
2 2 5|Xiu
1 4 5|Xiu
1 4 6|Tai
2 5 6|Tai
4 5 6|Tai
2 5 5|Tai
2 4 6|Xiu
1 1 5|Xiu
1 1 5|Xiu
1 3 3|Xiu
1 1 3|Tai
2 3 6|Xiu
1 1 5|Xiu
1 1 2|Xiu
2 2 6|Tai
2 6 6|Tai
2 5 6|Tai
4 5 5|Xiu
3 5 6|Tai
3 5 6|Tai
5 5 6|Xiu
2 3 5|Tai
3 3 6|Xiu
3 4 6|Xiu
1 2 5|Xiu
4 5 6|Tai
2 3 6|Xiu
1 4 5|Xiu
1 1 1|Tai
2 4 6|Xiu
1 2 4|Tai
3 4 6|Xiu
1 2 5|Xiu
1 3 6|Tai
1 6 6|Xiu
1 3 4|Tai
1 4 6|Xiu
2 2 6|Tai
1 5 6|Xiu
1 3 5|Tai
2 5 6|Xiu
1 2 4|Xiu
1 3 6|Tai
1 4 6|Xiu
2 2 3|Tai
4 4 5|Tai
2 4 5|Xiu
3 3 4|Xiu
2 2 2|Tai
4 5 6|Tai
1 6 6|Xiu
2 2 3|Xiu
2 2 3|Xiu
1 2 4|Tai
1 3 3|Tai
1 5 6|Tai
4 5 5|Xiu
1 2 5|Xiu
1 3 5|Tai
3 3 6|Tai
4 4 6|Tai
4 4 6|Xiu
3 3 3|Xiu
2 2 3|Tai
3 4 5|Tai
3 4 5|Xiu
2 3 5|Tai
2 3 6|Tai
1 6 6|Xiu
1 3 5|Xiu
1 3 6|Tai
1 5 5|Tai
3 3 6|Tai
2 5 5|Xiu
1 4 5|Tai
3 4 4|Xiu
2 3 5|Tai
3 5 6|Tai
5 6 6|Xiu
1 2 3|Xiu
2 3 5|Xiu
1 4 5|Tai
1 3 4|Xiu
1 3 5|Tai
2 4 6|Tai
2 4 5|Tai
5 6 6|Tai
5 5 6|Tai
4 4 4|Xiu
2 4 4|Xiu
1 3 6|Tai
1 4 6|Xiu
1 3 3|Xiu
1 2 4|Tai
1 6 6|Tai
2 3 6|Xiu
2 3 5|Xiu
1 4 4|Tai
3 4 4|Tai
1 6 6|Xiu
1 3 4|Tai
4 5 5|Xiu
1 3 4|Tai
3 4 4|Xiu
1 2 3|Xiu
1 2 5|Tai
4 4 5|Xiu
1 1 1|Tai
2 4 6|Tai
4 4 6|Xiu
1 3 3|Tai
1 5 6|Tai
1 4 6|Tai
4 4 5|Tai
2 4 5|Xiu
4 4 6|Xiu
1 2 4|Tai
2 6 6|Tai
2 6 6|Xiu
1 3 4|Xiu
2 2 3|Xiu
1 1 6|Tai
3 6 6|Tai
2 6 6|Tai
1 4 6|Tai
2 5 6|Xiu
2 2 6|Tai
3 3 6|Tai
1 5 6|Tai
4 4 5|Tai
3 3 6|Xiu
1 1 2|Tai
3 5 5|Tai
1 5 6|Xiu
2 3 5|Tai
1 2 3|Tai
2 6 6|Xiu
1 6 6|Tai
2 2 4|Xiu
2 2 6|Xiu
1 2 5|Tai
2 5 6|Xiu
2 2 2|Xiu
2 3 4|Xiu
2 2 3|Xiu
1 4 4|Xiu
2 2 2|Xiu
1 1 3|Xiu
1 3 4|Xiu
1 2 3|Tai
2 3 6|Tai
1 5 6|Tai
3 4 6|Tai
1 2 5|Tai
4 5 6|Tai
4 6 6|Xiu
1 1 4|Xiu
2 3 5|Xiu
2 2 6|Xiu
1 4 5|Xiu
2 3 5|Xiu
1 2 5|Xiu
4 5 6|Xiu
1 1 5|Xiu
1 3 6|Xiu
1 4 4|Xiu
2 3 5|Tai
4 4 5|Xiu
2 3 4|Tai
3 3 5|Tai
2 5 6|Tai
1 3 4|Xiu
1 4 5|Xiu
1 3 3|Tai
1 5 5|Xiu
1 2 4|Tai
2 5 5|Tai
3 4 6|Tai
3 4 5|Xiu
1 3 4|Xiu
2 3 5|Xiu
1 3 5|Tai
3 5 5|Tai
4 6 6|Xiu
2 3 6|Xiu
2 2 4|Xiu
3 3 4|Tai
2 2 3|Xiu
4 4 6|Tai
3 3 5|Tai
1 4 6|Tai
3 4 6|Xiu
2 3 5|Tai
1 3 4|Xiu
4 4 6|Xiu
1 1 3|Tai
5 6 6|Tai
1 3 4|Xiu
3 4 6|Xiu
1 2 6|Xiu
1 5 6|Xiu
1 1 6|Xiu
2 2 3|Xiu
1 3 6|Xiu
2 3 4|Xiu
1 2 2|Tai
2 4 5|Xiu
1 1 2|Xiu
1 4 4|Xiu
1 3 4|Xiu
2 3 3|Xiu
1 2 6|Xiu
1 1 4|Tai
2 5 5|Tai
2 4 6|Tai
4 4 4|Xiu
1 1 3|Tai
3 4 4|Tai
3 3 5|Tai
2 5 5|Tai
3 6 6|Tai
4 5 6|Tai
3 5 5|Xiu
2 3 3|Xiu
1 2 3|Tai
4 4 6|Tai
1 4 6|Xiu
2 3 5|Xiu
1 1 5|Tai
3 4 5|Xiu
2 3 3|Tai
4 5 5|Tai
2 4 6|Tai
3 3 5|Tai
2 5 5|Tai
3 4 4|Xiu
1 3 3|Xiu
2 2 3|Tai
2 6 6|Tai
3 4 5|Tai
3 6 6|Tai
2 3 6|Xiu
2 2 6|Tai
4 5 5|Tai
2 4 6|Tai
3 4 4|Tai
5 5 5|Tai
2 4 5|Xiu
3 4 6|Xiu
1 3 6|Tai
2 3 3|Xiu
2 3 3|Tai
3 6 6|Tai
2 4 6|Tai
3 5 5|Tai
1 4 6|Xiu
2 4 4|Tai
3 4 5|Tai
3 3 5|Tai
4 4 6|Xiu
1 3 4|Tai
4 5 6|Xiu
2 2 6|Xiu`;
    
    const blob = new Blob([vipData], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'cautaixiuvip.txt';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
    
    document.getElementById('loadStatus').innerHTML = 
      '<p style="color:#27ae60;">ƒê√£ t·∫£i file VIP th√†nh c√¥ng! H√£y t·∫£i l√™n ƒë·ªÉ s·ª≠ d·ª•ng.</p>';
  });

  // Reset l·ªãch s·ª≠
  document.getElementById('resetBtn').addEventListener('click', resetHistory);

  // Navigation buttons
  document.getElementById('prevBtn').addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      updateHistoryList();
    }
  });

  document.getElementById('nextBtn').addEventListener('click', () => {
    const totalPages = Math.ceil(predictionHistory.length / itemsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      updateHistoryList();
    }
  });

  // Nh·∫°c n·ªÅn b·∫≠t t·∫Øt
  const musicBtn = document.getElementById('musicControl');
  const music = document.getElementById('backgroundMusic');
  musicBtn.addEventListener('click', () => {
    if (music.paused) {
      music.play();
      musicBtn.textContent = '‚ùö‚ùö';
      musicBtn.classList.add('playing');
    } else {
      music.pause();
      musicBtn.textContent = '‚ñ∂';
      musicBtn.classList.remove('playing');
    }
  });

  // X·ª≠ l√Ω form ƒëƒÉng nh·∫≠p
  document.getElementById('loginForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    if (login(username, password)) {
      showMainUI();
      loadHistory();
    }
  });

  // X·ª≠ l√Ω form ƒëƒÉng k√Ω
  document.getElementById('registerForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;
    
    if (register(username, password)) {
      showLoginForm();
    }
  });

  // Chuy·ªÉn ƒë·ªïi gi·ªØa form ƒëƒÉng nh·∫≠p v√† ƒëƒÉng k√Ω
  document.getElementById('showRegister').addEventListener('click', e => {
    e.preventDefault();
    showRegisterForm();
  });

  document.getElementById('showLogin').addEventListener('click', e => {
    e.preventDefault();
    showLoginForm();
  });

  // ƒêƒÉng xu·∫•t
  document.getElementById('logoutBtn').addEventListener('click', logout);

  // Ki·ªÉm tra session khi t·∫£i trang
  function checkSession() {
    userIP = getClientIP();
    
    // Ki·ªÉm tra xem c√≥ session n√†o ƒëang ho·∫°t ƒë·ªông kh√¥ng
    if (userIP && userSessions[userIP]) {
      const session = userSessions[userIP];
      
      // Ki·ªÉm tra timeout
      if (session.timeout && session.timeout > Math.floor(Date.now() / 1000)) {
        // V·∫´n c√≤n timeout
        currentUser = session.username;
        showMainUI();
        activateTimeout(session.timeout - Math.floor(Date.now() / 1000));
        return;
      }
      
      // Session h·ª£p l·ªá
      currentUser = session.username;
      showMainUI();
      loadHistory();
    } else {
      // Kh√¥ng c√≥ session, hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p
      showAuthUI();
    }
  }

  // Th√™m s·ª± ki·ªán cho n√∫t admin (·∫©n)
  document.addEventListener('keydown', (e) => {
    // Ctrl+Alt+Shift+A ƒë·ªÉ m·ªü admin login
    if (e.ctrlKey && e.altKey && e.shiftKey && e.key === 'A') {
      const username = prompt('T√™n ƒëƒÉng nh·∫≠p Admin:');
      const password = prompt('M·∫≠t kh·∫©u Admin:');
      
      if (checkAdminLogin(username, password)) {
        showAdminPanel();
      } else {
        alert('Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ch√≠nh x√°c!');
      }
    }
  });

  // ƒê√≥ng admin panel
  document.getElementById('closeAdmin').addEventListener('click', () => {
    document.getElementById('adminOverlay').style.display = 'none';
  });

  // Chuy·ªÉn tab
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      document.getElementById('usersTab').style.display = 'none';
      document.getElementById('activityTab').style.display = 'none';
      
      if (tab.dataset.tab === 'users') {
        document.getElementById('usersTab').style.display = 'block';
      } else {
        document.getElementById('activityTab').style.display = 'block';
      }
    });
  });

  // T√¨m ki·∫øm ng∆∞·ªùi d√πng
  document.getElementById('adminSearch').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#usersList tr');
    
    rows.forEach(row => {
      const username = row.cells[0].textContent.toLowerCase();
      if (username.includes(searchTerm)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });

  // Kh·ªüi t·∫°o CAPTCHA
  updateLoginCaptcha();
  updateRegisterCaptcha();

  // Ki·ªÉm tra session khi t·∫£i trang
  checkSession();

})();
</script>

</body>
</html>
